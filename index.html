<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <title>BCPR280 Assignment 2</title>
  </head>

  <body>
    <h4>VueJS</h4>
    <div id="app1">
      <h1>Result of Correlation</h1>
      <input type="file" @change="onFileChange" multiple>
      <h4>r<sub>xy</sub> = {{result1}} </h4>
      <h4>r<sup>2</sup> = {{result2}}</h4>
      <input type="button" value="Correlation" @click="cal">

      <h1>Result of Regression</h1>
      <h4> <sub>0</sub> = {{result3}}</h4>
      <h4> <sub>1</sub> = {{result4}}</h4>
      <input type="button" value="Regression" @click="reg">
  <script src="VInter.js"></script>
    </div>

  <hr />

  <h4>ReatJS</h4>

  <div id="app2">
  </div>
  <script type="text/babel">
    class FileInput extends React.Component {
      constructor (props) {
        super(props)
        this.state = {
          result1:"",
          result2:"",
          result3:"",
          result4:"",
          content:'',
          array1:[],
          array2:[]
        }

        this.onFileChange = this.onFileChange.bind(this)
      }

      onFileChange (e) {
        let files = e.target.files
        if (files.length ==2) {
          this.loadNumbers(files)
        }
      }

      loadNumbers (file) {
        let reader1 = new FileReader()
        let reader2 = new FileReader()
        reader1.onload = (e) => {
        this.state.content = e.target.result


        this.setState({
          array1:this.state.content.split("\n").map(function(item) {
                return parseInt(item, 10);
              })
            },function(){//回调

          })
        }



        reader2.onload = (e) => {
        this.state.content = e.target.result

        this.setState({
          array2:this.state.content.split("\n").map(function(item) {
                return parseInt(item, 10);
              })
            },function(){//回调

          })




        // this.state.array2 = this.state.content.split("\n").map(function(item) {
        //       return parseInt(item, 10);
        //     });
        }
        reader1.readAsText(file[0])
        reader2.readAsText(file[1])
      }

      sumOfProduct(a,b){
        var n;
        var sum1 = 0;

        if (a.length >= b.length){
          n = b.length;
        }
        else{
          n = a.length;
        }
        for(var i=0; i<n;i++){
          sum1 += a[i]*b[i];
        //  console.log("X("+i+")+Y("+i+")="+sum1);
        }
        return sum1;
      }

    //summation of X(i)orY(i).
      sumOfArray(c){
        var sum2=0;
        for(var i=0; i< c.length;i++){
          sum2 += c[i];
        }
        return sum2;
      }

      sumOfSquared(d){
        var sum3=0;
        for(var i=0; i< d.length;i++){
          sum3 += Math.pow(d[i], 2);
        }
        return sum3;
      }

      avgOfArray(e){
        var avg;
        avg = this.sumOfArray(e)/e.length;
        return avg;
      }

      calNumerator(a,b){
        var nume;
        nume = a.length*this.sumOfProduct(a,b)-this.sumOfArray(a)*this.sumOfArray(b);
        return nume;
      }

      calDenominator(a,b){
        var denoP1;
        var denoP2;
        var deno;
        denoP1= a.length*this.sumOfSquared(a)-Math.pow(this.sumOfArray(a), 2);
        denoP2= b.length*this.sumOfSquared(b)-Math.pow(this.sumOfArray(b), 2);
        deno = Math.sqrt(denoP1*denoP2);
        return deno;
      }

      regNumerator(a,b){
        var numeP1 = this.sumOfProduct(a,b);
        var numeP2 = a.length*this.avgOfArray(a)*this.avgOfArray(b)
        var nume = numeP1 - numeP2;
        return nume
      }

      regDenominator(a){
        var deno = this.sumOfSquared(a) - a.length * Math.pow(this.avgOfArray(a),2)
        return deno;
      }

      //这一部分是correlation算式。
      cal(){
        console.log(this.state.array1)
        var s =this.calNumerator(this.state.array1,this.state.array2)/this.calDenominator(this.state.array1,this.state.array2);
        this.state.result1 = s;
        this.state.result2 = Math.pow(s,2);
        //this.result1 = this.array1[0];
      }

      reg(){
        var h = this.regNumerator(this.state.array1,this.state.array2)/this.regDenominator(this.state.array1);
        this.state.result3 = h;
        this.state.result4 = this.avgOfArray(this.state.array2) - h* this.avgOfArray(this.state.array1);
      }

      render () {
        return (
          <div>
            <input type='file' onChange={this.onFileChange} multiple/>
            <h1>Result of Correlation</h1>
            <h4>r<sub>xy</sub> = {this.state.result1} </h4>
            <h4>r<sup>2</sup> = {this.state.result2}</h4>
            <button onClick={this.cal}>

              Correlation
            </button>
{this.state.array1}zzz
            <br />
            <br />

            <h1>Result of Regression</h1>
            <h4>B <sub>0</sub> = {this.state.result3}</h4>
            <h4>B <sub>1</sub> = {this.state.result4}</h4>
            <button onClick={this.reg}>
              Correlation
            </button>
          </div>
        )
      }
    }

    const element = <FileInput />

    ReactDOM.render(
      element,
      document.getElementById('app2')
    )
  </script>

  </body>
</html>
