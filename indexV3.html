<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script src="CalculatorModel.js"></script>
    <title>BCPR280 Assignment 2</title>
  </head>

  <body>

    <h1>VueJS</h1>
    <div id="app1">
      <h3>Result of Correlation</h3>
      <input type="file" @change="onFileChange" multiple>
      <h4>r<sub>xy</sub> = {{result1}} </h4>
      <h4>r<sup>2</sup> = {{result2}}</h4>
      <input type="button" value="Correlation" @click="cal">

      <h3>Result of Regression</h3>
      <h4>Bata<sub>0</sub> = {{result3}}</h4>
      <h4>Bata<sub>1</sub> = {{result4}}</h4>
      <input type="button" value="Regression" @click="reg">
      <script src="VInter.js"></script>
    </div>
  <hr />


  <h1>ReatJS</h1>
  <div id="app2">
  </div>

  <script type="text/babel">
    class FileInput extends React.Component {
      constructor (props) {
        super(props)
        this.state = {
          calculator:"",
          result1:"",
          result2:"",
          result3:"",
          result4:"",
          content:'',
          array1:[],
          array2:[]
        }

        this.onFileChange = this.onFileChange.bind(this)
        this.cal = this.cal.bind(this)
        this.reg = this.reg.bind(this)
        this.calulator = new Calculator()
      }

      onFileChange (e) {
        let files = e.target.files
        if (files.length ==2) {
          this.loadNumbers(files)
        }
      }

      loadNumbers (file) {
        let reader1 = new FileReader()
        let reader2 = new FileReader()
        reader1.onload = (e) => {
        this.state.content = e.target.result
        this.setState({
          array1:this.state.content.split("\n").map(function(item) {
                return parseInt(item, 10);
              })
            })
        }
        reader2.onload = (e) => {
        this.state.content = e.target.result

        this.setState({
          array2:this.state.content.split("\n").map(function(item) {
                return parseInt(item, 10);
              })
            })
        }
        reader1.readAsText(file[0])
        reader2.readAsText(file[1])
      }

      //这一部分是correlation算式。
      cal(){
        console.log(this.state.array1)
        console.log(this.state.array2)
        var s =this.calulator.calNumerator(this.state.array1,this.state.array2)/this.calulator.calDenominator(this.state.array1,this.state.array2);
        //要用setState 方法赋值， 不能直接把值赋给属性成员
        // this.state.result1 = s;
        // this.state.result2 = Math.pow(s,2);
        this.setState({
            result1: s,
            result2: Math.pow(s,2)
        })
      }
      //这一部分是Regression算式。

      reg(){
        var h = this.calulator.regNumerator(this.state.array1,this.state.array2)/this.calulator.regDenominator(this.state.array1);
        // this.state.result3 = h;
        // this.state.result4 = this.avgOfArray(this.state.array2) - h* this.avgOfArray(this.state.array1);
        this.setState({
            result3: h,
            result4:  this.calulator.avgOfArray(this.state.array2) - h* this.calulator.avgOfArray(this.state.array1)
        })
      }

      render () {
        return (
          <div>
            <input type='file' onChange={this.onFileChange} multiple/>
            <h3>Result of Correlation</h3>
            <h4>r<sub>xy</sub> = {this.state.result1} </h4>
            <h4>r<sup>2</sup> = {this.state.result2}</h4>
            <button onClick={this.cal}>
              Correlation
            </button>
            <br />
            <br />

            <h3>Result of Regression</h3>
            <h4>B <sub>0</sub> = {this.state.result3}</h4>
            <h4>B <sub>1</sub> = {this.state.result4}</h4>
            <button onClick={this.reg}>
              Correlation
            </button>
          </div>
        )
      }
    }

    const element = <FileInput />

    ReactDOM.render(
      element,
      document.getElementById('app2')
    )
  </script>

  </body>
</html>
